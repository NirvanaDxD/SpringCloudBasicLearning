# 8.5

## 1. springcloud如何实现服务的注册?

通过Eureka Server提供服务注册服务，各个节点启动后，会在Eureka Server中进行注册， 这样Eureka Server中的服务注册表中将会存储所有可用服务节点的信息，服务节点的信息可以在界面中直观的看到。

 

## 2. Eureka是什么?

Eureka是Netflix开发的服务发现组件，本身是一个基于REST的服务。Spring Cloud将它集成在子项目Spring Cloud Netflix中，实现Spring Cloud的服务注册与发现，同时还提供了负载均衡、故障转移等能力。 

 

## 3. 注册中心的页面都有哪些信息展示?

System Status：系统状态展示

DS Replicas：注册中心集群列表

Instances currently registered with Eureka：已在注册中心中注册的服务列表

General Info：当前注册中心相关信息展示

Instance Info：当前注册中心实例信息展示

 

## 4. 什么是 spring cloud?

Spring Cloud是一系列框架的有序集合。它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务发现注册、配置中心、消息总线、负载均衡、断路器、数据监控等，都可以用Spring Boot的开发风格做到一键启动和部署。

Spring Cloud将比较成熟的服务框架组合起来，通过Spring Boot风格进行再封装屏蔽掉了复杂的配置和实现原理，最终给开发者留出了一套简单易懂、易部署和易维护的分布式系统开发工具包。

 

## 5. spring cloud的核心组件有哪些?

​     服务的发现----Netflix Eureka

​     服务的调用---- Netflix Feign

​     熔断器---- Netflix Hystrix

​     服务网关---- Netflix Zuul

​     分布式配置----Spring Cloud Config

​     消息总线----Spring Cloud Bus

 

## 6. SpringCloud和 Dubbo的区别?

SpringCloud：Spring公司开源的微服务框架，SpirngCloud 定位为微服务架构下的一站式解决方案。

Dubbo：阿里巴巴开源的RPC框架，Dubbo 是SOA 时代的产物，它的关注点主要在于服务的调用，流量分发、流量监控和熔断

Spring Cloud 的功能很明显比Dubbo 更加强大，涵盖面更广，而且作为Spring 的旗舰项目，它也能够与Spring Framework、Spring Boot、Spring Data、Spring Batch 等其他Spring 项目完美融合，这些对于微服务而言是至关重要的。

 

## 7. SpringBoot 和 SpringCloud的关系?

springboot是spring的一套快速配置脚手架，可以基于springboot快速开发单个微服务，springcloud是一个基于springboot实现的云应用开发工具

springboot专注于快速方便集成的单个微服务个体，springcloud关注全局的服务治理框架

springboot使用默认大于配置的理念，集成了很多方案，springcloud基于springboot实现，不可以不基于springboot搭建

springboot可以独立使用开发项目，但是springcloud不可以

 

## 8. Eureka有哪些属性?在搭建注册中心案例的时候yml文件中需要配置哪些属性?

![img](https://raw.githubusercontent.com/NirvanaDxD/PicGoSave/main/202208110939524.jpg)

 

# 8.8

## 1. 什么是高可用？

是分布式系统架构设计中必须考虑因素之一，它通常指，通过设计减少系统不能提供服务的时间。

![img](https://raw.githubusercontent.com/NirvanaDxD/PicGoSave/main/202208110940999.jpg)

 

## 2. eureka.client.registerWithEureka参数的含义以及对应的取值有哪些？各代表什么？

实例是否在eureka服务器上注册自己的信息以供其他服务发现，默认为true

 

## 3. eureka.client.fetchRegistry参数的含义以及对应的取值有哪些？各代表什么？

此客户端是否获取eureka服务器注册表上的注册信息，默认为true

 

## 4. eureka.client.service-url参数的含义以及对应的取值有哪些？各代表什么？

eureka实现集群的原理:让多台集群之间,互相注册,

defaultZone两种写法

1.将除自己以外的所有eureka节点都写进去，以" , "分隔

2.将所有的eureka节点都写进去，包括自己

 

# 8.9

## 1、什么是 Eureka 集群？

实际上就是启动多个Eureka实例， 多个Eureka实例之间互相注册，互相同步数据，共同组成一个Eureka集群。



## 2、如何理解 Eureka 的自我保护机制？

当Eureka Server节点在短时间内丢失过多客户端时（可能发生了网络分区故障），那么这个节点就会进入自我保护模式。一旦进入该模式，Eureka Server就会保护服务注册表中的信息，不再删除服务注册表中的数据（也就是不会注销任何微服务）。当网络故障恢复后，该Eureka Server节点会自动退出自我保护模式。

自我保护模式是一种应对网络异常的安全保护措施。它的架构哲学是宁可同时保留所有微服务（健康的微服务和不健康的微服务都会保留），也不盲目注销任何健康的微服务。使用自我保护模式，可以让Eureka集群更加的健壮、稳定。



## 3、如何理解 Eureka 高可用集群？ 

多个Eureka Server之间也会互相注册为服务，当服务提供者注册到Eureka Server集群中的某个节点时，该节点会把
服务的信息同步给集群中的每个节点，从而实现数据同步。因此，无论客户端访问到Eureka Server集群中的任意一
个节点，都可以获取到完整的服务列表信息。



## 4、微服务 RPC 远程服务调用最核心的问题是什么？即 Eureka 集群存在的意义是什么？

高可用。单机版 Eureka 有一个致命的风险点，就是 EurekaServer 一旦挂了，所有服务就没法进行远程服务调用，可能造成系统全面瘫痪。解决办法：搭建 Eureka 注册中心集群，实现负载均衡+故障容错

##  

## 5、多个 Eureka 实例之间的关系是什么？

互相注册，互相同步数据





# 8.10

## 1、什么是集群？ 

集群是一组相互独立的、通过高速计算机网络互联的计算机，它们构成了一个组，并以单一系统的模式加以管理。计算机集群简称集群是一种计算机系统， 它通过一组松散集成的计算机软件/硬件连接起来高度紧密地协作完成计算工作。



## 2、什么是服务续约？ 

在注册服务完成以后,服务提供者会维持一个心跳(每30s定时向EurekaServer分发起请求)告诉EurekaServer"我还活着"



## 3、什么是失效剔除？ 

有时候.我们的服务提供方并不一定是正常下线.可能是内存溢出,网络故障等原因导致服务无法正常工作.EurekaServer会将这些失效的服务剔除服务列表.因此它会开启一个定时任务.每隔60秒会对失效的服务进行一次剔除



## 4、什么是自我保护？ 

当服务未按时进行心跳续约时,在生产环境下.因为网络原因,此时就把服务从服务列表中剔除并不妥当发.因为服务也有可能未宕机.Eureka就会把当前实例的注册信息保护起来,不允剔除.这种方式在生产环境下很有效,保证了大多数服务依然可用。


## 5、客户端如何拉取服务端已保存的服务信息，是需要使用的时候再去拉取，还是先拉取保存本地，使用的时候直接从本地获取吗？

客户端拉取服务端服务信息是通过一个定时任务定时拉取的，每次拉取后刷新本地已保存的信息，需要使用时直接从本地直接获取。



## 6、客户端启动时如何注册到服务端？ 

Eureka客户端在启动时，首先会创建一个心跳的定时任务，定时向服务端发送心跳信息，服务端会对客户端心跳做出响应，如果响应状态码为404时，表示服务端没有该客户端的服务信息，那么客户端则会向服务端发送注册请求，注册信息包括服务名、ip、端口、唯一实例ID等信息。



## 7、Eureka 工作原理？ 

 Eureka Server 集群相互之间通过 Replicate 来同步数据，相互之间不区分主节点和从节点，所有的节点都是平等的。在这种架构中，节点通过彼此互相注册来提高可用性，每个节点需要添加一个或多个有效的 serviceUrl 指向其他节点。



## 8、若是不使用 Eureka 注册中心的状况下,分布式服务必然面临的问题有哪些?

服务管理 : 

​      如何自动注册和发现服务.

​      如何实现服务状态的监管.

​      如何实现动态路由,从而实现负载均衡.

服务如何实现负载均衡

服务如何解决容灾问题

服务如何实现统一配置



# 8.11

## 1. 什么是Ribbon?

spring cloud ribbon是基于Netflix ribbon实现的一套客户端负载均衡的工具。



## 2. Ribbon 能做什么？

Ribbon客户端组件提供一系列完善的配置项如：连接超时，重试等。简单的说，就是在配置文件中列出Load Balancer(简称LB)后面所有的机器，Ribbon会自动的帮助你基于某种规则（如简单轮询、随机连接等）去连接这些机器。我们很容易的使用Ribbon实现自定义的负载均衡算法。



## 3. Load Balance 负载均衡是什么

简单的说就是讲用户的请求平摊分配到多个服务上，从而达到系统的HA（高可用）。



## 4. Ribbon 本地负载均衡客户端与Nginx 服务端负载均衡区别是什么？

Nginx是服务器负载均衡，客户端所有请求都会交给NGINX，然后又NGINX实现转发请求。即负载均衡是有服务端实现的。

Ribbon本地负载均衡，在调用微服务接口时候，会在注册中心获取注册信息服务列表之后缓存到JVM本地，从而在本地实现RPC远程服务调用技术。



## 5.集中式 LB 和进程内 LB 分别是什么？

集中式LB即在服务的消费方和提供方之间使用独立的LB设施(可以是硬件，如F5, 也可以是软件，如nginx)，由该设施负责把访问请求通过某种策略转发至服务的提供方;
进程内LB将LB逻辑集成到消费方，消费方从服务注册中心获知有哪些地址可用，然后自己再从这些地址中选择出一个合适的服务器。Ribbon就属于进程内LB，它只是一个类库，集成于消费方进程，消费方通过它来获取到服务提供方的地址。

## 6. Ribbon 默认自带的负载规则

RoundRobinRule: 轮询
RandomRule: 随机
RetryRule: 先按照RoundRobinRule的策略获取服务，如果获取服务失败则在指定时间内会进行重
WeightedResponseTimeRule: 对RoundRobinRule的扩展，响应速度越快的实例选择权重越大，越容易被选择
BestAvailableRule: 会先过滤掉由于多次访问故障而处于断路器跳闸状态的服务，然后选择一个并发量最小的服务
AvailabilityFilteringRule: 先过滤掉故障实例，再选择并发较小的实例
ZoneAvoidanceRule: 默认规则,复合判断server所在区域的性能和server的可用性选择服务器



## 7. Ribbon 中的组件 有哪些？

IRule、IPing、ServerList 、ServerListFilter、ServerListUpdater、ILoadBalancer



# 8.12

## 1、为什么需要Hystrix?
“hystrix就是对服务进行隔离保护。以实现服务不会出现连带故障。导致整个系统不可用 hystrix 对服务进行隔离保护”

## 2、Hystrix是什么？

Hystrix是一个用于处理分布式系统的延迟和容错的开源库，在分布式系统里，许多依赖不可避免的会调用失败，比如超时、异常等，Hystrix能够保证在一个依赖出问题的情况下，不会导致整体服务失败，避免级联故障，以提高分布式系统的弹性。

## 3、Hystrix能解决什么问题?

线程池隔离:Hystrix隔离方式采用线程/信号量的方式,通过隔离限制依赖的并发量和阻塞扩散 
线程隔离: hystrix在每一个依赖调用分配了一个线程池,单线程池满了调用将会立即被拒绝,默认采用不排队,加速失败判定,线程数是可以被设定的。

## 4、什么是服务雪崩？

是一种因服务"提供者"的不可用导致服务"调用者"的不可用,并将不可用逐渐放大的过程

## 5、造成雪崩的原因有哪些？

1）服务提供者不可用
•	a）硬件故障：硬件损坏造成的服务器主机宕机, 网络硬件故障造成的服务提供者的不可访问
•	b）程序Bug:
•	c) 缓存击穿：缓存击穿一般发生在缓存应用重启, 所有缓存被清空时,以及短时间内大量缓存失效时. 大量的缓存不命中, 使请求直击后端,造成服务提供者超负荷运行,引起服务不可用
•	d）用户大量请求：在秒杀和大促开始前,如果准备不充分,用户发起大量请求也会造成服务提供者的不可用
2）重试加大流量
•	a）用户重试：在服务提供者不可用后, 用户由于忍受不了界面上长时间的等待,而不断刷新页面甚至提交表单
•	b）代码逻辑重试: 服务调用端的会存在大量服务异常后的重试逻辑
3）服务调用者不可用
•	a）同步等待造成的资源耗尽：当服务调用者使用同步调用 时, 会产生大量的等待线程占用系统资源. 一旦线程资源被耗尽,服务调用者提供的服务也将处于不可用状态, 于是服务雪崩效应产生了。

## 6、如何解决灾难性雪崩效应？

SpringCloud Netflix 的 Hystrix组件，解决服务雪崩问题的逻辑是：不可用服务的调用快速失败。一般通过以下三点来实现：
•	资源隔离 
•	熔断器
•	熔断后的 降级方法

## 7、什么是服务熔断和服务降级？

服务熔断一般是指软件系统中，由于某些原因使得服务出现了过载现象，为防止造成整个系统故障，从而采用的一种保护措施，所以很多地方把熔断亦称为过载保护；
服务降级是在服务器压力陡增的情况下，利用有限资源，根据当前业务情况，关闭某些服务接口或者页面，以此释放服务器资源以保证核心任务的正常运行。

## 8、Hystrix设计原则是什么？

（1）对依赖服务调用时出现的调用延迟和调用失败进行控制和容错保护
（2）在复杂的分布式系统中，阻止某一个依赖服务的故障在整个系统中蔓延，服务A->服务B->服务C，服务C故障了，服务B也故障了，服务A故障了，整套分布式系统全部故障，整体宕机
（3）提供fail-fast（快速失败）和快速恢复的支持
（4）提供fallback优雅降级的支持
（5）支持近实时的监控、报警以及运维操作

## 9、Hystrix 有哪两种命令模式？

HystrixCommand或者HystrixObservableCommand
两种命令模式,可以分别执行:.execute()、.queue()、.observe()和.toObservable()。
